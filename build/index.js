!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.element,n=window.wp.domReady,o=e.n(n),c=window.wp.blockLibrary,r=(window.wp.editPost,window.wp.apiFetch),l=e.n(r),i=window.wp.blockEditor;function a(){const[e,n]=(0,t.useState)([]);return(0,t.createElement)(i.BlockEditorProvider,{value:e,onInput:e=>n(e),onChange:e=>n(e)})}window.wp.components;var s=window.wp.blocks;document.addEventListener("DOMContentLoaded",(function(){let e=document.querySelector("#convert-content"),t=document.querySelector("#doaction"),n=document.querySelector("#scan-content"),o=document.querySelector("#bca-converter-cancel"),c=document.querySelectorAll(".bca-single-convert"),r=document.querySelector("#bca-converter-modal"),i=document.querySelector("#bca-converter-precentage"),a=document.querySelector("#bca-converter-status-message"),d=!1;function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;d?document.location.href=document.location.href:(""==a.innerHTML&&(a.innerHTML="<p>Scanning... 0%</p>"),l()({path:`bca-blocks-converter/v1/scan/?offset=${e}&total=${t}`}).then((e=>{if("object"==typeof e)if(e.error)a.innerHTML=e.message;else{if(i.style.width=e.percentage+"%",e.offset>=e.total)return n.setAttribute("disabled",!1),a.innerHTML=e.message,document.querySelector("#bca-converter-spinner").style.display="none",document.querySelector("#checkmark-complete").style.display="inline-block",document.querySelector("#bca-converter-cancel").innerHTML="Continue",document.querySelector("#bca-converter-cancel").classList.remove("button-remove"),document.querySelector("#bca-converter-cancel").classList.add("button-success"),void document.querySelector("#bca-converter-cancel").addEventListener("click",(function(){document.location.href=document.location.href+"&scan_finished=1"}));a.innerHTML=e.message,u(e.offset,e.total)}else console.log("Failed")})).catch((e=>{a.innerHTML=bcaConvert.serverErrorMessage,document.querySelector("#bca-converter-cancel").addEventListener("click",(function(){document.location.href=document.location.href}))})))}function v(e){document.querySelector(".bca-single-convert-"+e).innerHTML="Converting...",l()({path:`bca-blocks-converter/v1/single/convert/?id=${e}`}).then((t=>{if("object"!=typeof t)return void console.log("Failed");let n=b(t);!function(e,t){let n={post_id:e,post_content:t};l()({path:"bca-blocks-converter/v1/single/update/",method:"POST",data:n}).then((t=>{"object"==typeof t?(document.querySelector("#bca-convert-checkbox-"+e).setAttribute("disabled",!0),document.querySelector("#bca-convert-checkbox-"+e).setAttribute("checked",!1),document.querySelector("#bca-convert-checkbox-"+e).removeAttribute("checked"),document.querySelector("#bca-convert-checkbox-"+e).closest("tr").classList.add("is_gutenberg"),document.querySelector(".bca-single-convert-"+e).innerHTML="Converted"):document.querySelector(".bca-single-convert-"+e).innerHTML=bcaConvert.failedMessage})).catch((e=>{a.innerHTML=bcaConvert.failedMessage}))}(e,n)}))}function f(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(d)return r.style.display="none",e.removeAttribute("disabled"),n.removeAttribute("disabled"),document.querySelector("#bca-converter-list").style.filter="none",void(document.querySelector("#bca-converter-list").style.pointerEvents="auto");""==a.innerHTML&&(a.innerHTML="<p>Converting... 0%</p>"),l()({path:`bca-blocks-converter/v1/bulk/convert/?offset=${t}&total=${o}`}).then((e=>{if("object"==typeof e)if(e.error)a.innerHTML=e.message;else if(i.style.width=e.percentage+"%",e.offset>=e.total)a.innerHTML=e.message;else{for(var t=[],n=e.postsData.length,o=0;o<n;o++){var c={id:e.postsData[o].id,content:b(e.postsData[o])};t.push(c)}m(t,e.offset,e.total,e.message)}else console.log("Failed")})).catch((e=>{a.innerHTML=bcaConvert.serverErrorMessage,document.querySelector("#bca-converter-cancel").addEventListener("click",(function(){document.location.href=document.location.href}))}))}function b(e){let t=(0,s.pasteHandler)({HTML:e.content});return t.forEach((t=>{if("core/gallery"==t.name){let n=t.attributes.images;void 0!==e.gallery&&n.forEach(((t,n)=>{void 0!==e.gallery[t.id]&&(t.url=e.gallery[t.id].url,t.alt=e.gallery[t.id].alt,t.caption=e.gallery[t.id].caption)}))}})),console.log(t),console.log((0,s.serialize)(t)),(0,s.serialize)(t)}function m(e,t,o,c){let r={offset:t,total:o,postsData:e};l()({path:"bca-blocks-converter/v1/bulk/update/",method:"POST",data:r}).then((e=>{if("object"==typeof e){if(e.offset>=e.total)return n.setAttribute("disabled",!1),void(a.innerHTML=e.message);a.innerHTML=c,f(e.offset,e.total)}else document.querySelector(".bca-single-convert-"+postID).innerHTML=bcaConvert.failedMessage}))}c.forEach((e=>{e.addEventListener("click",(function(e){console.log(this.id),v(this.id)}))})),n.addEventListener("click",(function(e){r.style.display="flex",document.querySelector("#bca-converter-list").style.filter="blur(2px)",document.querySelector("#bca-converter-list").style.pointerEvents="none",u()})),t&&t.addEventListener("click",(function(e){e.preventDefault(),document.querySelectorAll('input[name="bulk-convert[]"]').forEach((e=>{1==e.checked&&v(e.value)}))})),e&&e.addEventListener("click",(function(e){r.style.display="flex",f()})),o.addEventListener("click",(function(){d=!0}))})),o()((function(){const e=window.getdaveSbeSettings||{};(0,c.registerCoreBlocks)(),(0,t.render)((0,t.createElement)(a,{settings:e}),document.getElementById("bcaConvertEditor"))}))}();